import{u as B,b as T,r as h,j as f}from"./index-Dk8juSHD.js";import{u as R}from"./useQuery-CttvB5Qk.js";import{u,b as V}from"./store-DYT5Yrjk.js";import{N as $}from"./NavBar-hxvd4kHp.js";import{u as A,m as x,M as I,i as N,f as C,a as D,b as M,c as Y,p as X,v as q,d as F,e as _,g as w,h as G,w as U,j as J}from"./motion-PHSgthsk.js";const K=({pages:e,chapterID:s,nextChapter:r,prevChapter:t})=>{const n=u(c=>c.scrollPosition);window.scrollTo(0,n.position);const{selectedSlug:o}=B(),i=T();h.useEffect(()=>{const c=()=>{const m=window.scrollY;u.setState({scrollPosition:{chapterID:s,position:m}}),window.scrollTo(0,n.position)};return window.addEventListener("scroll",c),()=>{window.removeEventListener("scroll",c)}},[u.getState().scrollPosition,s]);const l=()=>{i(`/view-manga/${o}/${r==null?void 0:r.hid}`)},a=()=>{i(`/view-manga/${o}/${t==null?void 0:t.hid}`)},d=u.getState().imageUrlPrefix;return f.jsxs("div",{className:"overflow-y-scroll flex flex-col place-self-center md:w-1/2 md:mr-[25%] md:ml-[25%]",children:[e.reverse().map(c=>f.jsx("img",{loading:"lazy",src:`${d}/${c.b2key}`,className:`w-full h-[${c.h}px]`},c.b2key)),f.jsxs("div",{className:"h-svh flex flex-col text-4xl justify-around",children:[f.jsx("p",{className:"place-self-center",children:"fin."}),f.jsxs("div",{className:"flex flex-row  justify-around ",children:[f.jsx("button",{className:"btn btn-outline",disabled:t==null,onClick:a,children:"Previous"}),f.jsx("button",{className:"btn btn-outline",disabled:r==null,onClick:l,children:"Next"})]})]})]})};function Q(e){const s=A(()=>x(e)),{isStatic:r}=h.useContext(I);if(r){const[,t]=h.useState(e);h.useEffect(()=>s.on("change",t),[])}return s}function Z(e,s={}){const{isStatic:r}=h.useContext(I),t=h.useRef(null),n=Q(N(e)?e.get():e),o=()=>{t.current&&t.current.stop()};return h.useInsertionEffect(()=>n.attach((i,l)=>{if(r)return l(i);const a=t.current;return a&&a.time===0&&a.sample(C.delta),o(),t.current=D({keyframes:[n.get(),i],velocity:n.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...s,onUpdate:l}),n.get()},o),[JSON.stringify(s)]),M(()=>{if(N(e))return e.on("change",i=>n.set(parseFloat(i)))},[n]),n}function ee(e,s,r){var t;if(typeof e=="string"){let n=document;s&&(Y(!!s.current),n=s.current),r?((t=r[e])!==null&&t!==void 0||(r[e]=n.querySelectorAll(e)),e=r[e]):e=n.querySelectorAll(e)}else e instanceof Element&&(e=[e]);return Array.from(e||[])}const S=new WeakMap;let p;function te(e,s){if(s){const{inlineSize:r,blockSize:t}=s[0];return{width:r,height:t}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function se({target:e,contentRect:s,borderBoxSize:r}){var t;(t=S.get(e))===null||t===void 0||t.forEach(n=>{n({target:e,contentSize:s,get size(){return te(e,r)}})})}function ne(e){e.forEach(se)}function re(){typeof ResizeObserver>"u"||(p=new ResizeObserver(ne))}function oe(e,s){p||re();const r=ee(e);return r.forEach(t=>{let n=S.get(t);n||(n=new Set,S.set(t,n)),n.add(s),p==null||p.observe(t)}),()=>{r.forEach(t=>{const n=S.get(t);n==null||n.delete(s),n!=null&&n.size||p==null||p.unobserve(t)})}}const E=new Set;let y;function ie(){y=()=>{const e={width:window.innerWidth,height:window.innerHeight},s={target:window,size:e,contentSize:e};E.forEach(r=>r(s))},window.addEventListener("resize",y)}function le(e){return E.add(e),y||ie(),()=>{E.delete(e),!E.size&&y&&(y=void 0)}}function ce(e,s){return typeof e=="function"?le(e):oe(e,s)}const ae=50,P=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),fe=()=>({time:0,x:P(),y:P()}),de={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function H(e,s,r,t){const n=r[s],{length:o,position:i}=de[s],l=n.current,a=r.time;n.current=e["scroll"+i],n.scrollLength=e["scroll"+o]-e["client"+o],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=X(0,n.scrollLength,n.current);const d=t-a;n.velocity=d>ae?0:q(n.current-l,d)}function ue(e,s,r){H(e,"x",s,r),H(e,"y",s,r),s.time=r}function ge(e,s){const r={x:0,y:0};let t=e;for(;t&&t!==s;)if(t instanceof HTMLElement)r.x+=t.offsetLeft,r.y+=t.offsetTop,t=t.offsetParent;else if(t.tagName==="svg"){const n=t.getBoundingClientRect();t=t.parentElement;const o=t.getBoundingClientRect();r.x+=n.left-o.left,r.y+=n.top-o.top}else if(t instanceof SVGGraphicsElement){const{x:n,y:o}=t.getBBox();r.x+=n,r.y+=o;let i=null,l=t.parentNode;for(;!i;)l.tagName==="svg"&&(i=l),l=t.parentNode;t=i}else break;return r}const he={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},L={start:0,center:.5,end:1};function W(e,s,r=0){let t=0;if(L[e]!==void 0&&(e=L[e]),typeof e=="string"){const n=parseFloat(e);e.endsWith("px")?t=n:e.endsWith("%")?e=n/100:e.endsWith("vw")?t=n/100*document.documentElement.clientWidth:e.endsWith("vh")?t=n/100*document.documentElement.clientHeight:e=n}return typeof e=="number"&&(t=s*e),r+t}const pe=[0,0];function me(e,s,r,t){let n=Array.isArray(e)?e:pe,o=0,i=0;return typeof e=="number"?n=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?n=e.split(" "):n=[e,L[e]?e:"0"]),o=W(n[0],r,t),i=W(n[1],s),o-i}const ve={x:0,y:0};function xe(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function ye(e,s,r){const{offset:t=he.All}=r,{target:n=e,axis:o="y"}=r,i=o==="y"?"height":"width",l=n!==e?ge(n,e):ve,a=n===e?{width:e.scrollWidth,height:e.scrollHeight}:xe(n),d={width:e.clientWidth,height:e.clientHeight};s[o].offset.length=0;let c=!s[o].interpolate;const m=t.length;for(let g=0;g<m;g++){const z=me(t[g],d[i],a[i],l[o]);!c&&z!==s[o].interpolatorOffsets[g]&&(c=!0),s[o].offset[g]=z}c&&(s[o].interpolate=F(s[o].offset,_(t)),s[o].interpolatorOffsets=[...s[o].offset]),s[o].progress=s[o].interpolate(s[o].current)}function we(e,s=e,r){if(r.x.targetOffset=0,r.y.targetOffset=0,s!==e){let t=s;for(;t&&t!==e;)r.x.targetOffset+=t.offsetLeft,r.y.targetOffset+=t.offsetTop,t=t.offsetParent}r.x.targetLength=s===e?s.scrollWidth:s.clientWidth,r.y.targetLength=s===e?s.scrollHeight:s.clientHeight,r.x.containerLength=e.clientWidth,r.y.containerLength=e.clientHeight}function Se(e,s,r,t={}){return{measure:()=>we(e,t.target,r),update:n=>{ue(e,r,n),(t.offset||t.target)&&ye(e,r,t)},notify:()=>s(r)}}const v=new WeakMap,j=new WeakMap,b=new WeakMap,O=e=>e===document.documentElement?window:e;function Ee(e,{container:s=document.documentElement,...r}={}){let t=b.get(s);t||(t=new Set,b.set(s,t));const n=fe(),o=Se(s,e,n,r);if(t.add(o),!v.has(s)){const l=()=>{for(const g of t)g.measure()},a=()=>{for(const g of t)g.update(C.timestamp)},d=()=>{for(const g of t)g.notify()},c=()=>{w.read(l,!1,!0),w.read(a,!1,!0),w.update(d,!1,!0)};v.set(s,c);const m=O(s);window.addEventListener("resize",c,{passive:!0}),s!==document.documentElement&&j.set(s,ce(s,c)),m.addEventListener("scroll",c,{passive:!0})}const i=v.get(s);return w.read(i,!1,!0),()=>{var l;G(i);const a=b.get(s);if(!a||(a.delete(o),a.size))return;const d=v.get(s);v.delete(s),d&&(O(s).removeEventListener("scroll",d),(l=j.get(s))===null||l===void 0||l(),window.removeEventListener("resize",d))}}function k(e,s){U(!!(!s||s.current))}const be=()=>({scrollX:x(0),scrollY:x(0),scrollXProgress:x(0),scrollYProgress:x(0)});function Le({container:e,target:s,layoutEffect:r=!0,...t}={}){const n=A(be);return(r?M:h.useEffect)(()=>(k("target",s),k("container",e),Ee(({x:i,y:l})=>{n.scrollX.set(i.current),n.scrollXProgress.set(i.progress),n.scrollY.set(l.current),n.scrollYProgress.set(l.progress)},{...t,container:(e==null?void 0:e.current)||void 0,target:(s==null?void 0:s.current)||void 0})),[e,s,JSON.stringify(t.offset)]),n}const je=()=>{var a;const{scrollYProgress:e}=Le(),s=Z(e,{stiffness:100,damping:30,restDelta:.001}),r=h.useRef(null),{chapterHID:t}=B(),{isPending:n,error:o,data:i}=R({queryKey:["fetchChapterPages",t??""],queryFn:()=>V(t??""),enabled:!!t}),l=u.getState().chapters;if(o)return"Error";if(n)return"Loading Pages";if(i){const d=i.chapter.md_images,c=l.find(m=>m.hid===t)||null;if(c)return c.pages=d,u.setState({selectedChapter:c}),u.getState().selectedChapter&&f.jsxs("div",{className:"bg-light-primary text-light-secondary dark:bg-dark-primary dark:text-dark-secondary min-h-screen max-h-full overflow-y-scroll",children:[f.jsx(J.div,{initial:"hidden",whileInView:"visible",style:{scaleX:s},className:"fixed top-16 left-0 right-0 bg-light-secondary dark:bg-dark-primary origin-left h-2 z-10",viewport:{root:r}}),f.jsxs("div",{className:"flex flex-col gap-4",ref:r,children:[f.jsx($,{previousPage:u.getState().selectedManga.title}),f.jsx("h1",{className:"place-self-center text-2xl mt-20",children:u.getState().selectedManga.title}),f.jsxs("div",{className:"=flex flex-col place-content-center text-center",children:[f.jsxs("h2",{className:"place-self-center mb-12",children:[(a=u.getState().selectedChapter)==null?void 0:a.chapterNumber,". ",u.getState().selectedChapter.title]}),f.jsx(K,{pages:u.getState().selectedChapter.pages,chapterID:t,nextChapter:i.next,prevChapter:i.prev})]})]})]})}};export{je as default};
